import Canvas from "../dist/canvas/canvas.js"
import Vector2D from "../dist/geometric/Vector2D.js"
import Point2D from "../dist/geometric/Point2D.js"
import Line2D from "../dist/geometric/Line2D.js"

test("constructor should accept 5 overloads", () => {
  const l1 = new Line2D(10, 20, 30, 40)
  expect(l1.x).toBe(10)
  expect(l1.y).toBe(20)
  expect(l1.p.x).toBe(30)
  expect(l1.p.y).toBe(40)
  const l2 = new Line2D(l1)
  expect(l2 === l1).toBe(false)
  expect(l2.x).toBe(10)
  expect(l2.y).toBe(20)
  expect(l2.p.x).toBe(30)
  expect(l2.p.y).toBe(40)

  const p1 = new Point2D(10, 55)
  const v1 = new Vector2D(15, 45)
  const l3 = new Line2D(p1, v1)
  expect(l3.x).toBe(10)
  expect(l3.y).toBe(55)
  expect(l3.p.x).toBe(15)
  expect(l3.p.y).toBe(45)

  const p2 = new Point2D(15, 15)
  const l4_1 = new Line2D(p2, -Math.PI / 4, 10)
  const l4_2 = new Line2D(p2, -45, 10, true)
  expect(l4_1.x).toBe(15)
  expect(l4_1.y).toBe(15)
  expect(l4_2.x).toBe(15)
  expect(l4_2.y).toBe(15)
  expect(l4_1.p.x).toBeCloseTo(22.07)
  expect(l4_2.p.x).toBeCloseTo(22.07)
  expect(l4_1.p.y).toBeCloseTo(7.9289)
  expect(l4_2.p.y).toBeCloseTo(7.9289)
  expect(l4_1.angle(true)).toBeCloseTo(-45, 6)
  expect(l4_2.angle(true)).toBeCloseTo(-45, 6)

  const l5_1 = new Line2D(10, 10, Math.PI / 4, 100, true)
  const l5_2 = new Line2D(10, 10, 45, 100, true, true)
  expect(l5_1.x).toBe(10)
  expect(l5_2.x).toBe(10)
  expect(l5_1.y).toBe(10)
  expect(l5_2.y).toBe(10)
  expect(l5_1.angle(true)).toBeCloseTo(45, 6)
  expect(l5_2.angle(true)).toBeCloseTo(45, 6)
  expect(l5_1.length()).toBeCloseTo(100, 6)
  expect(l5_2.length()).toBeCloseTo(100, 6)
})

test("cloneLine should return new line", () => {
  const l1 = new Line2D(10, 20, 30, 40)
  const l2 = l1.cloneLine()
  l1.moveLineBy(30)
  expect(l1.x).toBe(40)
  expect(l1.y).toBe(50)
  expect(l1.p.x).toBe(60)
  expect(l1.p.y).toBe(70)
  expect(l2 === l1).toBe(false)
  expect(l2.x).toBe(10)
  expect(l2.y).toBe(20)
  expect(l2.p.x).toBe(30)
  expect(l2.p.y).toBe(40)
})

test("angle should return correct number", () => {
  const l1 = new Line2D(10, 10, 10, 40)
  const ang1 = l1.angle(true)
  expect(ang1).toBeCloseTo(90)
  const l2 = new Line2D(10, 10, 40, 40)
  const ang2 = l2.angle(true)
  expect(ang2).toBeCloseTo(45)
  const l3 = new Line2D(10, 10, 45, 10, true, true)
  const ang3 = l3.angle()
  expect(ang3).toBeCloseTo(Math.PI / 4)
  const l4 = new Line2D(50, 50, 40, 40)
  const ang4 = l4.angle(true)
  expect(ang4).toBeCloseTo(-135)
})

test("length should return correct number", () => {
  const l1 = new Line2D(10, 10, 10, 40)
  const len1 = l1.length()
  expect(len1).toBe(30)
  const l2 = new Line2D(50, 40, 10, 10)
  const len2 = l2.length()
  expect(len2).toBe(50)
})

test("reverse should return same line reversed", () => {
  const l1 = new Line2D(10, 20, 30, 40)
  const l2 = l1.reverse()
  expect(l2 === l1).toBe(true)
  expect(l2.x).toBe(30)
  expect(l2.y).toBe(40)
  expect(l2.p.x).toBe(10)
  expect(l2.p.y).toBe(20)
})

test("deltaVector should return new vector", () => {
  const l1 = new Line2D(10, 20, 30, 45)
  const v1 = l1.deltaVector()
  expect(v1.x).toBe(20)
  expect(v1.y).toBe(25)
})

test("deltaVectorBack should return new vector", () => {
  const l1 = new Line2D(10, 20, 30, 45)
  const v1 = l1.deltaVectorBack()
  expect(v1.x).toBe(-20)
  expect(v1.y).toBe(-25)
})

test("rotateFromP1 should return same rotated line", () => {
  const l1 = new Line2D(100, 100, 0, 10, true, true)
  const l2 = l1.rotateFromP1(90, true)
  expect(l2 === l1).toBe(true)
  expect(l1.x).toBe(100)
  expect(l1.y).toBe(100)
  expect(l1.p.x).toBe(100)
  expect(l1.p.y).toBe(110)
  l1.rotateFromP1(Math.PI)
  expect(l1.p.x).toBe(100)
  expect(l1.p.y).toBe(90)
})

test("rotateFromP2 should return same rotated line", () => {
  const l1 = new Line2D(100, 100, 0, 10, true, true)
  const l2 = l1.rotateFromP2(90, true)
  expect(l2 === l1).toBe(true)
  expect(l1.p.x).toBe(110)
  expect(l1.p.y).toBe(100)
  expect(l1.x).toBe(110)
  expect(l1.y).toBe(90)
  l1.rotateFromP2(Math.PI)
  expect(l1.p.x).toBe(110)
  expect(l1.p.y).toBe(100)
})

test("scaleLine should return same scaled line", () => {
  const l1 = new Line2D(100, 100, 45, 10, true, true)
  expect(l1.angle(true)).toBeCloseTo(45, 6)
  l1.scaleLine(2)
  expect(l1.angle(true)).toBeCloseTo(45, 6)
  expect(l1.length()).toBe(20)
})

test("scaleLineTo should return same scaled line", () => {
  const l1 = new Line2D(100, 100, 45, 10, true, true)
  expect(l1.angle(true)).toBeCloseTo(45, 6)
  l1.scaleLineTo(25)
  expect(l1.angle(true)).toBeCloseTo(45, 6)
  expect(l1.length()).toBe(25)
})

test("moveLineToByP1 should return same line with 2 overloads", () => {
  const l1 = new Line2D(10, 10, 20, 20)
  l1.moveLineToByP1(20, 20)
  expect(l1.x).toBe(20)
  expect(l1.y).toBe(20)
  expect(l1.p.x).toBe(30)
  expect(l1.p.y).toBe(30)
  const v1 = new Vector2D(5, 5)
  l1.moveLineToByP1(v1)
  expect(l1.x).toBe(5)
  expect(l1.y).toBe(5)
  expect(l1.p.x).toBe(15)
  expect(l1.p.y).toBe(15)
})

test("moveLineToByP2 should return same line with 2 overloads", () => {
  const l1 = new Line2D(10, 10, 20, 20)
  l1.moveLineToByP2(10, 10)
  expect(l1.x).toBe(0)
  expect(l1.y).toBe(0)
  expect(l1.p.x).toBe(10)
  expect(l1.p.y).toBe(10)
  const v1 = new Vector2D(25, 25)
  l1.moveLineToByP2(v1)
  expect(l1.x).toBe(15)
  expect(l1.y).toBe(15)
  expect(l1.p.x).toBe(25)
  expect(l1.p.y).toBe(25)
})

test("moveLineTo should return same line with 2 overloads", () => {
  const l1 = new Line2D(10, 10, 20, 20)
  l1.moveLineTo(15, 15, 25, 25)
  expect(l1.x).toBe(15)
  expect(l1.y).toBe(15)
  expect(l1.p.x).toBe(25)
  expect(l1.p.y).toBe(25)
  const v1 = new Vector2D(25, 25)
  const v2 = new Vector2D(50, 50)
  l1.moveLineTo(v1, v2)
  expect(l1.x).toBe(25)
  expect(l1.y).toBe(25)
  expect(l1.p.x).toBe(50)
  expect(l1.p.y).toBe(50)
})

test("moveLineBy should return same line with 2 (6 optional) overloads", () => {
  const l1 = new Line2D(10, 10, 20, 20)
  l1.moveLineBy(10)
  expect(l1.x).toBe(20)
  expect(l1.y).toBe(20)
  expect(l1.p.x).toBe(30)
  expect(l1.p.y).toBe(30)
  l1.moveLineBy(-10, 10)
  expect(l1.x).toBe(10)
  expect(l1.y).toBe(30)
  expect(l1.p.x).toBe(20)
  expect(l1.p.y).toBe(40)
  l1.moveLineBy(10, 15, 20, 25)
  expect(l1.x).toBe(20)
  expect(l1.y).toBe(45)
  expect(l1.p.x).toBe(40)
  expect(l1.p.y).toBe(65)
  const v1 = new Vector2D(5, 10)
  l1.moveLineBy(v1)
  expect(l1.x).toBe(25)
  expect(l1.y).toBe(55)
  expect(l1.p.x).toBe(45)
  expect(l1.p.y).toBe(75)
  const v2 = new Vector2D(5, 10)
  const v3 = new Vector2D(20, 15)
  l1.moveLineBy(v2, v3)
  expect(l1.x).toBe(30)
  expect(l1.y).toBe(65)
  expect(l1.p.x).toBe(65)
  expect(l1.p.y).toBe(90)
})

test("toString should return correct string", () => {
  const v1 = new Line2D(10, 15, 20, 25)
  const ss = v1.toString()
  expect(ss).toBe(`[Line2D(10,15,20,25)]`)
})
//    toString() {
//       return `[Line2D(${this.x},${this.y},${this.p.x},${this.p.y})]`
//    }

// }
